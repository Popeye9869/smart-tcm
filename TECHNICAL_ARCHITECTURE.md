# æ™ºèƒ½ä¸­åŒ»è¯Šç–—ç³»ç»Ÿ - æŠ€æœ¯æ¶æ„æ–‡æ¡£

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### æ•´ä½“æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯å±‚ (Frontend)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Vue 3 + TypeScript + Vite + Element Plus + Pinia        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    APIç½‘å…³å±‚ (API Gateway)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ä¸šåŠ¡æœåŠ¡å±‚ (Backend Services)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  è¯Šæ–­æœåŠ¡   â”‚  ç—…å†æœåŠ¡   â”‚  çŸ¥è¯†åº“æœåŠ¡ â”‚  ç”¨æˆ·æœåŠ¡   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æ•°æ®å±‚ (Data Layer)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å…³ç³»æ•°æ®åº“  â”‚  ç¼“å­˜æœåŠ¡   â”‚  æ–‡ä»¶å­˜å‚¨   â”‚  æœç´¢å¼•æ“   â”‚   â”‚
â”‚  â”‚ PostgreSQL  â”‚   Redis     â”‚   MinIO     â”‚ Elasticsearchâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    AIæœåŠ¡å±‚ (AI Services)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å¤§è¯­è¨€æ¨¡å‹  â”‚  çŸ¥è¯†å›¾è°±   â”‚  æ¨èå¼•æ“   â”‚  è‡ªç„¶è¯­è¨€å¤„ç†â”‚   â”‚
â”‚  â”‚   GPT-4     â”‚  Neo4j      â”‚  TensorFlow â”‚   spaCy     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ å‰ç«¯æ¶æ„è¯¦è§£

### æŠ€æœ¯æ ˆé€‰æ‹©
- **æ¡†æ¶**: Vue 3.5.22 - æ¸è¿›å¼JavaScriptæ¡†æ¶
- **è¯­è¨€**: TypeScript 5.9.0 - ç±»å‹å®‰å…¨çš„JavaScriptè¶…é›†
- **æ„å»ºå·¥å…·**: Vite 7.1.7 - å¿«é€Ÿçš„å‰ç«¯æ„å»ºå·¥å…·
- **UIæ¡†æ¶**: Element Plus 2.11.4 - Vue 3ç»„ä»¶åº“
- **çŠ¶æ€ç®¡ç†**: Pinia 3.0.3 - Vueå®˜æ–¹çŠ¶æ€ç®¡ç†åº“
- **è·¯ç”±ç®¡ç†**: Vue Router 4.5.1 - Vue.jså®˜æ–¹è·¯ç”±ç®¡ç†å™¨
- **HTTPå®¢æˆ·ç«¯**: Axios 1.12.2 - åŸºäºPromiseçš„HTTPåº“
- **åŠ¨ç”»**: @vueuse/motion - Vueç»„åˆå¼åŠ¨ç”»åº“
- **å›½é™…åŒ–**: Vue I18n 9.14.5 - Vue.jså›½é™…åŒ–æ’ä»¶

### é¡¹ç›®ç»“æ„
```
src/
â”œâ”€â”€ assets/                    # é™æ€èµ„æº
â”‚   â”œâ”€â”€ images/               # å›¾ç‰‡èµ„æº
â”‚   â”œâ”€â”€ styles/               # å…¨å±€æ ·å¼
â”‚   â””â”€â”€ fonts/                # å­—ä½“æ–‡ä»¶
â”œâ”€â”€ components/               # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ common/              # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ diagnosis/           # è¯Šæ–­ç›¸å…³ç»„ä»¶
â”‚   â”œâ”€â”€ knowledge/           # çŸ¥è¯†åº“ç»„ä»¶
â”‚   â”œâ”€â”€ records/             # ç—…å†ç»„ä»¶
â”‚   â””â”€â”€ ui/                  # UIç»„ä»¶
â”œâ”€â”€ locales/                  # å›½é™…åŒ–é…ç½®
â”‚   â”œâ”€â”€ zh-CN.json           # ç®€ä½“ä¸­æ–‡
â”‚   â”œâ”€â”€ zh-TW.json           # ç¹ä½“ä¸­æ–‡
â”‚   â””â”€â”€ en-US.json           # è‹±æ–‡
â”œâ”€â”€ router/                   # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ index.ts             # è·¯ç”±å®šä¹‰
â”œâ”€â”€ services/                 # APIæœåŠ¡å±‚
â”‚   â”œâ”€â”€ api.ts               # APIåŸºç¡€é…ç½®
â”‚   â”œâ”€â”€ auth.service.ts      # è®¤è¯æœåŠ¡
â”‚   â”œâ”€â”€ diagnosis.service.ts # è¯Šæ–­æœåŠ¡
â”‚   â”œâ”€â”€ knowledge.service.ts # çŸ¥è¯†åº“æœåŠ¡
â”‚   â””â”€â”€ records.service.ts   # ç—…å†æœåŠ¡
â”œâ”€â”€ stores/                   # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ auth.store.ts        # ç”¨æˆ·è®¤è¯çŠ¶æ€
â”‚   â”œâ”€â”€ diagnosis.store.ts   # è¯Šæ–­çŠ¶æ€
â”‚   â”œâ”€â”€ knowledge.store.ts   # çŸ¥è¯†åº“çŠ¶æ€
â”‚   â””â”€â”€ records.store.ts     # ç—…å†çŠ¶æ€
â”œâ”€â”€ types/                    # TypeScriptç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ auth.types.ts        # è®¤è¯ç›¸å…³ç±»å‹
â”‚   â”œâ”€â”€ diagnosis.types.ts   # è¯Šæ–­ç›¸å…³ç±»å‹
â”‚   â”œâ”€â”€ knowledge.types.ts   # çŸ¥è¯†åº“ç±»å‹
â”‚   â””â”€â”€ common.types.ts      # é€šç”¨ç±»å‹
â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ constants.ts         # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ helpers.ts           # è¾…åŠ©å‡½æ•°
â”‚   â”œâ”€â”€ validators.ts        # éªŒè¯å‡½æ•°
â”‚   â””â”€â”€ formatters.ts        # æ ¼å¼åŒ–å‡½æ•°
â”œâ”€â”€ views/                    # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ HomeView.vue         # é¦–é¡µ
â”‚   â”œâ”€â”€ DiagnosisView.vue    # è¯Šæ–­é¡µé¢
â”‚   â”œâ”€â”€ KnowledgeView.vue    # çŸ¥è¯†åº“é¡µé¢
â”‚   â”œâ”€â”€ RecordsView.vue      # ç—…å†é¡µé¢
â”‚   â”œâ”€â”€ ProfileView.vue      # ä¸ªäººä¸­å¿ƒ
â”‚   â””â”€â”€ AboutView.vue        # å…³äºé¡µé¢
â”œâ”€â”€ App.vue                   # æ ¹ç»„ä»¶
â””â”€â”€ main.ts                   # åº”ç”¨å…¥å£
```

### æ ¸å¿ƒæ¨¡å—è®¾è®¡

#### 1. çŠ¶æ€ç®¡ç†æ¶æ„ (Pinia)
```typescript
// stores/diagnosis.store.ts
export const useDiagnosisStore = defineStore('diagnosis', {
  state: () => ({
    currentDiagnosis: null as Diagnosis | null,
    currentPrescription: null as Prescription | null,
    medicalRecords: [] as MedicalRecord[],
    isLoading: false,
    error: null as string | null
  }),
  
  getters: {
    diagnosisCount: (state) => state.medicalRecords.length,
    latestDiagnosis: (state) => state.medicalRecords[0]
  },
  
  actions: {
    async startDiagnosis(patientInfo: PatientInfo) {
      this.isLoading = true
      this.error = null
      
      try {
        const response = await diagnosisService.startDiagnosis(patientInfo)
        this.currentDiagnosis = response.data
      } catch (error) {
        this.error = error.message
        throw error
      } finally {
        this.isLoading = false
      }
    },
    
    async generatePrescription(diagnosis: Diagnosis) {
      const response = await diagnosisService.generatePrescription(diagnosis)
      this.currentPrescription = response.data
    },
    
    saveDiagnosisRecord(record: MedicalRecord) {
      this.medicalRecords.unshift(record)
      this.persistToLocalStorage()
    },
    
    persistToLocalStorage() {
      localStorage.setItem('medicalRecords', JSON.stringify(this.medicalRecords))
    }
  }
})
```

#### 2. è·¯ç”±æ¶æ„ (Vue Router)
```typescript
// router/index.ts
const routes: RouteRecordRaw[] = [
  {
    path: '/',
    name: 'home',
    component: () => import('@/views/HomeView.vue'),
    meta: { title: 'é¦–é¡µ', requiresAuth: false }
  },
  {
    path: '/diagnosis',
    name: 'diagnosis',
    component: () => import('@/views/DiagnosisView.vue'),
    meta: { title: 'æ™ºèƒ½è¯Šæ–­', requiresAuth: true }
  },
  {
    path: '/knowledge',
    name: 'knowledge',
    component: () => import('@/views/KnowledgeView.vue'),
    meta: { title: 'ä¸­åŒ»çŸ¥è¯†åº“', requiresAuth: true }
  },
  {
    path: '/records',
    name: 'records',
    component: () => import('@/views/RecordsView.vue'),
    meta: { title: 'ç—…å†ç®¡ç†', requiresAuth: true }
  },
  {
    path: '/profile',
    name: 'profile',
    component: () => import('@/views/ProfileView.vue'),
    meta: { title: 'ä¸ªäººä¸­å¿ƒ', requiresAuth: true }
  },
  {
    path: '/about',
    name: 'about',
    component: () => import('@/views/AboutView.vue'),
    meta: { title: 'å…³äºæˆ‘ä»¬', requiresAuth: false }
  },
  {
    path: '/login',
    name: 'login',
    component: () => import('@/views/LoginView.vue'),
    meta: { title: 'ç™»å½•', requiresAuth: false }
  }
]
```

#### 3. æœåŠ¡å±‚æ¶æ„ (Axios)
```typescript
// services/api.ts
const api = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: Number(import.meta.env.VITE_API_TIMEOUT) || 30000,
  headers: {
    'Content-Type': 'application/json'
  }
})

// è¯·æ±‚æ‹¦æˆªå™¨
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('token')
    if (token) {
      config.headers.Authorization = `Bearer ${token}`
    }
    return config
  },
  (error) => {
    return Promise.reject(error)
  }
)

// å“åº”æ‹¦æˆªå™¨
api.interceptors.response.use(
  (response) => {
    return response.data
  },
  (error) => {
    if (error.response?.status === 401) {
      // å¤„ç†æœªæˆæƒ
      router.push('/login')
    }
    return Promise.reject(error)
  }
)
```

## ğŸ¤– AIæœåŠ¡é›†æˆæ¶æ„

### å¤§è¯­è¨€æ¨¡å‹é›†æˆ
```typescript
// services/ai.service.ts
export class AIService {
  private apiKey: string
  private baseURL: string
  private model: string

  constructor() {
    this.apiKey = import.meta.env.VITE_AI_API_KEY
    this.baseURL = import.meta.env.VITE_AI_API_BASE_URL
    this.model = import.meta.env.VITE_AI_MODEL || 'gpt-4'
  }

  async diagnose(symptoms: SymptomInfo): Promise<DiagnosisResponse> {
    const prompt = this.buildDiagnosisPrompt(symptoms)
    
    try {
      const response = await this.callLLM(prompt)
      return this.parseDiagnosisResponse(response)
    } catch (error) {
      console.error('AIè¯Šæ–­å¤±è´¥:', error)
      throw new Error('AIè¯Šæ–­æœåŠ¡æš‚æ—¶ä¸å¯ç”¨')
    }
  }

  async prescribe(diagnosis: DiagnosisResponse): Promise<PrescriptionResponse> {
    const prompt = this.buildPrescriptionPrompt(diagnosis)
    
    try {
      const response = await this.callLLM(prompt)
      return this.parsePrescriptionResponse(response)
    } catch (error) {
      console.error('AIå¤„æ–¹ç”Ÿæˆå¤±è´¥:', error)
      throw new Error('AIå¤„æ–¹æœåŠ¡æš‚æ—¶ä¸å¯ç”¨')
    }
  }

  private async callLLM(prompt: string): Promise<string> {
    const response = await fetch(`${this.baseURL}/chat/completions`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${this.apiKey}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        model: this.model,
        messages: [{ role: 'user', content: prompt }],
        temperature: 0.7,
        max_tokens: 2000
      })
    })

    if (!response.ok) {
      throw new Error(`LLM API error: ${response.status}`)
    }

    const data = await response.json()
    return data.choices[0].message.content
  }

  private buildDiagnosisPrompt(symptoms: SymptomInfo): string {
    return `
ä½œä¸ºä¸€ä½ç»éªŒä¸°å¯Œçš„ä¸­åŒ»ä¸“å®¶ï¼Œè¯·æ ¹æ®ä»¥ä¸‹ç—‡çŠ¶ä¿¡æ¯è¿›è¡Œä¸­åŒ»è¯Šæ–­ï¼š

ä¸»è¦ç—‡çŠ¶ï¼š${symptoms.mainSymptoms.join(', ')}
ç—‡çŠ¶æè¿°ï¼š${symptoms.symptomDetails}
ä¼´éšç—‡çŠ¶ï¼š${symptoms.accompanyingSymptoms.join(', ')}
è¯±å‘å› ç´ ï¼š${symptoms.triggeringFactors}

å››è¯Šä¿¡æ¯ï¼š
- æœ›è¯Šï¼šé¢è‰²${symptoms.fourDiagnostics.inspection.complexion}ï¼ŒèˆŒè´¨${symptoms.fourDiagnostics.inspection.tongueColor}ï¼ŒèˆŒè‹”${symptoms.fourDiagnostics.inspection.tongueCoating}
- é—»è¯Šï¼šå£°éŸ³${symptoms.fourDiagnostics.auscultation.voice}ï¼Œå‘¼å¸${symptoms.fourDiagnostics.auscultation.breathing}
- é—®è¯Šï¼šé¥®é£Ÿ${symptoms.fourDiagnostics.inquiry.diet}ï¼Œç¡çœ ${symptoms.fourDiagnostics.inquiry.sleep}ï¼ŒäºŒä¾¿${symptoms.fourDiagnostics.inquiry.bowel}ã€${symptoms.fourDiagnostics.inquiry.urine}
- åˆ‡è¯Šï¼šè„‰è±¡${symptoms.fourDiagnostics.palpation.pulse}ï¼Œè…¹éƒ¨${symptoms.fourDiagnostics.palpation.abdomen}

è¯·æä¾›ï¼š
1. è¯å‹åˆ†æ
2. ç—…å› ç—…æœº
3. ç—…ä½åˆ†æ
4. ç—…æ€§åˆ†æ
5. è¯Šæ–­ä¾æ®

è¯·ä»¥JSONæ ¼å¼è¿”å›ç»“æœã€‚
    `.trim()
  }
}
```

### çŸ¥è¯†å›¾è°±é›†æˆ
```typescript
// services/knowledge-graph.service.ts
export class KnowledgeGraphService {
  private neo4j: Neo4jService

  async getSyndromeInfo(syndromeName: string): Promise<SyndromeInfo> {
    const query = `
      MATCH (syndrome:Syndrome {name: $syndromeName})-[r]->(related)
      RETURN syndrome, collect(related) as relatedNodes
    `
    
    const result = await this.neo4j.run(query, { syndromeName })
    return this.mapToSyndromeInfo(result)
  }

  async getHerbInfo(herbName: string): Promise<HerbInfo> {
    const query = `
      MATCH (herb:Herb {name: $herbName})-[r]->(related)
      RETURN herb, collect(related) as relatedNodes
    `
    
    const result = await this.neo4j.run(query, { herbName })
    return this.mapToHerbInfo(result)
  }

  async findSimilarCases(symptoms: string[]): Promise<MedicalCase[]> {
    const query = `
      MATCH (case:MedicalCase)-[:HAS_SYMPTOM]->(symptom:Symptom)
      WHERE symptom.name IN $symptoms
      RETURN case, count(symptom) as symptomCount
      ORDER BY symptomCount DESC
      LIMIT 10
    `
    
    const result = await this.neo4j.run(query, { symptoms })
    return result.records.map(record => this.mapToMedicalCase(record))
  }
}
```

## ğŸ¨ UI/UXæ¶æ„è®¾è®¡

### è®¾è®¡ç³»ç»Ÿæ¶æ„
```css
/* assets/styles/variables.css */
:root {
  /* ä¸­åŒ»ä¸»é¢˜è‰²å½© */
  --tcm-primary: #8B4513;        /* è¯æ£•è‰² - ä¸»è‰²è°ƒ */
  --tcm-secondary: #A0522D;        /* èµ­çŸ³è‰² - æ¬¡è¦è‰² */
  --tcm-accent: #D2691E;         /* å·§å…‹åŠ›è‰² - å¼ºè°ƒè‰² */
  --tcm-success: #228B22;        /* æ£®æ—ç»¿ - æˆåŠŸè‰² */
  --tcm-warning: #DAA520;         /* é‡‘é»„è‰² - è­¦å‘Šè‰² */
  --tcm-error: #DC143C;          /* æ·±çº¢è‰² - é”™è¯¯è‰² */
  
  /* èƒŒæ™¯è‰²å½© */
  --tcm-background: #F5E6D3;      /* å®£çº¸è‰² - èƒŒæ™¯è‰² */
  --tcm-surface: #FAF0E6;        /* äºšéº»è‰² - è¡¨é¢è‰² */
  --tcm-surface-variant: #F0E5D8; /* ç±³ç™½è‰² - è¡¨é¢å˜ä½“ */
  
  /* æ–‡æœ¬è‰²å½© */
  --tcm-text-primary: #2F1B14;    /* æ·±æ£•è‰² - ä¸»è¦æ–‡æœ¬ */
  --tcm-text-secondary: #5D4037; /* æ£•è¤è‰² - æ¬¡è¦æ–‡æœ¬ */
  --tcm-text-disabled: #A1887F;   /* æµ…æ£•è‰² - ç¦ç”¨æ–‡æœ¬ */
  
  /* é—´è·ç³»ç»Ÿ */
  --tcm-spacing-xs: 4px;
  --tcm-spacing-sm: 8px;
  --tcm-spacing-md: 16px;
  --tcm-spacing-lg: 24px;
  --tcm-spacing-xl: 32px;
  
  /* åœ†è§’ç³»ç»Ÿ */
  --tcm-radius-sm: 4px;
  --tcm-radius-md: 8px;
  --tcm-radius-lg: 12px;
  --tcm-radius-xl: 16px;
  
  /* é˜´å½±ç³»ç»Ÿ */
  --tcm-shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
  --tcm-shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
  --tcm-shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
  
  /* å­—ä½“ç³»ç»Ÿ */
  --tcm-font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  --tcm-font-size-xs: 12px;
  --tcm-font-size-sm: 14px;
  --tcm-font-size-base: 16px;
  --tcm-font-size-lg: 18px;
  --tcm-font-size-xl: 20px;
  --tcm-font-size-2xl: 24px;
}

/* æš—è‰²ä¸»é¢˜ */
[data-theme="dark"] {
  --tcm-primary: #D2691E;
  --tcm-secondary: #CD853F;
  --tcm-background: #1E1A17;
  --tcm-surface: #2A251F;
  --tcm-surface-variant: #3A342C;
  --tcm-text-primary: #F5E6D3;
  --tcm-text-secondary: #D2B48C;
  --tcm-text-disabled: #A0826D;
}
```

### å“åº”å¼è®¾è®¡æ¶æ„
```css
/* æ–­ç‚¹ç³»ç»Ÿ */
/* Mobile First è®¾è®¡ */
.container {
  width: 100%;
  padding: 0 var(--tcm-spacing-md);
  margin: 0 auto;
}

/* å¹³æ¿è®¾å¤‡ */
@media (min-width: 768px) {
  .container {
    max-width: 750px;
  }
  
  .grid-cols-responsive {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* æ¡Œé¢è®¾å¤‡ */
@media (min-width: 1024px) {
  .container {
    max-width: 970px;
  }
  
  .grid-cols-responsive {
    grid-template-columns: repeat(3, 1fr);
  }
}

/* å¤§å±å¹•è®¾å¤‡ */
@media (min-width: 1200px) {
  .container {
    max-width: 1170px;
  }
  
  .grid-cols-responsive {
    grid-template-columns: repeat(4, 1fr);
  }
}

/* è¶…å¤§å±å¹• */
@media (min-width: 1400px) {
  .container {
    max-width: 1320px;
  }
}
```

### åŠ¨ç”»ç³»ç»Ÿæ¶æ„
```typescript
// utils/animations.ts
export const animations = {
  // é¡µé¢è¿‡æ¸¡åŠ¨ç”»
  pageTransition: {
    initial: { opacity: 0, y: 20 },
    enter: { opacity: 1, y: 0 },
    exit: { opacity: 0, y: -20 },
    transition: { duration: 0.3, ease: 'easeInOut' }
  },
  
  // å¡ç‰‡åŠ¨ç”»
  cardAnimation: {
    initial: { opacity: 0, scale: 0.9 },
    enter: { opacity: 1, scale: 1 },
    transition: { duration: 0.4, ease: 'easeOut' }
  },
  
  // åˆ—è¡¨é¡¹åŠ¨ç”»
  listItemAnimation: {
    initial: { opacity: 0, x: -20 },
    enter: { opacity: 1, x: 0 },
    transition: { duration: 0.3, ease: 'easeOut' }
  },
  
  // æŒ‰é’®åŠ¨ç”»
  buttonAnimation: {
    whileHover: { scale: 1.05 },
    whileTap: { scale: 0.95 },
    transition: { duration: 0.1 }
  },
  
  // æ¨¡æ€æ¡†åŠ¨ç”»
  modalAnimation: {
    initial: { opacity: 0, scale: 0.8 },
    enter: { opacity: 1, scale: 1 },
    exit: { opacity: 0, scale: 0.8 },
    transition: { duration: 0.2, ease: 'easeOut' }
  }
}
```

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–æ¶æ„

### ä»£ç åˆ†å‰²ç­–ç•¥
```typescript
// vite.config.ts - ä¼˜åŒ–æ„å»ºé…ç½®
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          // Vueæ ¸å¿ƒåº“
          'vue-vendor': ['vue', 'vue-router', 'pinia'],
          
          // UIç»„ä»¶åº“
          'ui-vendor': ['element-plus'],
          
          // å·¥å…·åº“
          'utils-vendor': ['axios', 'dayjs', 'lodash-es'],
          
          // åŠ¨ç”»åº“
          'animation-vendor': ['@vueuse/motion'],
          
          // å›½é™…åŒ–
          'i18n-vendor': ['vue-i18n']
        }
      }
    },
    
    // ä»£ç å‹ç¼©
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true,
        pure_funcs: ['console.log']
      }
    }
  },
  
  // ä¼˜åŒ–ä¾èµ–é¢„æ„å»º
  optimizeDeps: {
    include: [
      'vue',
      'vue-router',
      'pinia',
      'element-plus',
      'axios'
    ]
  }
})
```

### å›¾ç‰‡ä¼˜åŒ–ç­–ç•¥
```typescript
// utils/image-optimization.ts
export const imageOptimization = {
  // ç”Ÿæˆå“åº”å¼å›¾ç‰‡
  generateResponsiveImage(src: string, sizes: number[]) {
    return sizes.map(size => ({
      src: `${src}?w=${size}`,
      size: `${size}w`
    }))
  },
  
  // æ‡’åŠ è½½é…ç½®
  lazyLoading: {
    rootMargin: '50px',
    threshold: 0.1,
    loading: 'lazy'
  },
  
  // WebPæ”¯æŒæ£€æµ‹
  supportsWebP(): Promise<boolean> {
    return new Promise(resolve => {
      const webP = new Image()
      webP.onload = webP.onerror = () => {
        resolve(webP.height === 2)
      }
      webP.src = 'data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA'
    })
  }
}
```

### ç¼“å­˜ç­–ç•¥
```typescript
// utils/cache.ts
export class CacheManager {
  private memoryCache = new Map<string, CacheItem>()
  
  set(key: string, data: any, ttl: number = 300000) { // é»˜è®¤5åˆ†é’Ÿ
    const item: CacheItem = {
      data,
      expiry: Date.now() + ttl
    }
    this.memoryCache.set(key, item)
  }
  
  get(key: string): any | null {
    const item = this.memoryCache.get(key)
    
    if (!item) return null
    
    if (Date.now() > item.expiry) {
      this.memoryCache.delete(key)
      return null
    }
    
    return item.data
  }
  
  clear() {
    this.memoryCache.clear()
  }
  
  cleanup() {
    const now = Date.now()
    for (const [key, item] of this.memoryCache.entries()) {
      if (now > item.expiry) {
        this.memoryCache.delete(key)
      }
    }
  }
}
```

## ğŸ”’ å®‰å…¨æ¶æ„

### å‰ç«¯å®‰å…¨ç­–ç•¥
```typescript
// utils/security.ts
export class SecurityManager {
  // XSSé˜²æŠ¤
  sanitizeInput(input: string): string {
    const div = document.createElement('div')
    div.textContent = input
    return div.innerHTML
  }
  
  // CSRFé˜²æŠ¤
  getCSRFToken(): string {
    const token = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content')
    return token || ''
  }
  
  // æ•æ„Ÿæ•°æ®åŠ å¯†
  encryptData(data: string, key: string): string {
    // å®ç°ç®€å•çš„åŠ å¯†é€»è¾‘
    return btoa(data + key)
  }
  
  // æ•°æ®è„±æ•
  maskSensitiveData(data: string, type: 'phone' | 'email' | 'id'): string {
    switch (type) {
      case 'phone':
        return data.replace(/(\d{3})\d{4}(\d{4})/, '$1****$2')
      case 'email':
        return data.replace(/(.{2}).+(.{2}@.+)/, '$1****$2')
      case 'id':
        return data.replace(/(\d{4})\d{10}(\d{4})/, '$1**********$2')
      default:
        return data
    }
  }
}
```

### è®¤è¯æˆæƒæ¶æ„
```typescript
// services/auth.service.ts
export class AuthService {
  private token: string | null = null
  private refreshToken: string | null = null
  
  async login(credentials: LoginCredentials): Promise<AuthResponse> {
    try {
      const response = await api.post('/auth/login', credentials)
      const { token, refreshToken, user } = response.data
      
      this.token = token
      this.refreshToken = refreshToken
      
      // å­˜å‚¨åˆ°æœ¬åœ°å­˜å‚¨
      localStorage.setItem('token', token)
      localStorage.setItem('refreshToken', refreshToken)
      localStorage.setItem('user', JSON.stringify(user))
      
      return { token, refreshToken, user }
    } catch (error) {
      throw new Error('ç™»å½•å¤±è´¥')
    }
  }
  
  async refreshAccessToken(): Promise<string> {
    try {
      const response = await api.post('/auth/refresh', {
        refreshToken: this.refreshToken
      })
      
      const { token } = response.data
      this.token = token
      localStorage.setItem('token', token)
      
      return token
    } catch (error) {
      // åˆ·æ–°å¤±è´¥ï¼Œéœ€è¦é‡æ–°ç™»å½•
      this.logout()
      throw new Error('éœ€è¦é‡æ–°ç™»å½•')
    }
  }
  
  logout(): void {
    this.token = null
    this.refreshToken = null
    localStorage.clear()
    router.push('/login')
  }
  
  getToken(): string | null {
    return this.token || localStorage.getItem('token')
  }
  
  isAuthenticated(): boolean {
    return !!this.getToken()
  }
}
```

## ğŸ“Š æ•°æ®æ¶æ„

### æ•°æ®æ¨¡å‹è®¾è®¡
```typescript
// types/diagnosis.types.ts
export interface Diagnosis {
  id: string
  patientInfo: PatientInfo
  symptoms: SymptomInfo
  fourDiagnostics: FourDiagnostics
  aiAnalysis: AIAnalysis
  result: DiagnosisResult
  prescription: Prescription
  treatmentPlan: TreatmentPlan
  createdAt: string
  updatedAt: string
}

export interface PatientInfo {
  name: string
  age: number
  gender: 'male' | 'female'
  medicalHistory: string[]
  allergies: string[]
  constitutionType?: ConstitutionType
}

export interface SymptomInfo {
  mainSymptoms: string[]
  symptomDetails: string
  accompanyingSymptoms: string[]
  triggeringFactors: string
  severity: 1 | 2 | 3 | 4 | 5
}

export interface FourDiagnostics {
  inspection: InspectionInfo
  auscultation: AuscultationInfo
  inquiry: InquiryInfo
  palpation: PalpationInfo
}

export interface AIAnalysis {
  syndromeType: string
  etiology: string
  pathogenesis: string
  diseaseLocation: string[]
  diseaseNature: string[]
  diagnosisBasis: string[]
  confidence: number
  similarCases: MedicalCase[]
}
```

### æ•°æ®æŒä¹…åŒ–ç­–ç•¥
```typescript
// utils/storage.ts
export class StorageManager {
  // æœ¬åœ°å­˜å‚¨
  static setItem(key: string, value: any): void {
    try {
      const serializedValue = JSON.stringify(value)
      localStorage.setItem(key, serializedValue)
    } catch (error) {
      console.error('LocalStorageè®¾ç½®å¤±è´¥:', error)
    }
  }
  
  static getItem(key: string): any | null {
    try {
      const serializedValue = localStorage.getItem(key)
      return serializedValue ? JSON.parse(serializedValue) : null
    } catch (error) {
      console.error('LocalStorageè·å–å¤±è´¥:', error)
      return null
    }
  }
  
  static removeItem(key: string): void {
    localStorage.removeItem(key)
  }
  
  static clear(): void {
    localStorage.clear()
  }
  
  // ä¼šè¯å­˜å‚¨
  static setSessionItem(key: string, value: any): void {
    try {
      const serializedValue = JSON.stringify(value)
      sessionStorage.setItem(key, serializedValue)
    } catch (error) {
      console.error('SessionStorageè®¾ç½®å¤±è´¥:', error)
    }
  }
  
  static getSessionItem(key: string): any | null {
    try {
      const serializedValue = sessionStorage.getItem(key)
      return serializedValue ? JSON.parse(serializedValue) : null
    } catch (error) {
      console.error('SessionStorageè·å–å¤±è´¥:', error)
      return null
    }
  }
}
```

## ğŸ§ª æµ‹è¯•æ¶æ„

### å•å…ƒæµ‹è¯•æ¶æ„
```typescript
// tests/unit/components/DiagnosisForm.spec.ts
import { describe, it, expect, vi } from 'vitest'
import { mount } from '@vue/test-utils'
import DiagnosisForm from '@/components/diagnosis/DiagnosisForm.vue'

describe('DiagnosisForm', () => {
  it('åº”è¯¥æ­£ç¡®æ¸²æŸ“ç—‡çŠ¶è¾“å…¥è¡¨å•', () => {
    const wrapper = mount(DiagnosisForm)
    
    expect(wrapper.find('[data-testid="symptom-input"]').exists()).toBe(true)
    expect(wrapper.find('[data-testid="submit-button"]').exists()).toBe(true)
  })
  
  it('åº”è¯¥åœ¨è¡¨å•æäº¤æ—¶è§¦å‘è¯Šæ–­äº‹ä»¶', async () => {
    const wrapper = mount(DiagnosisForm)
    const symptomInput = wrapper.find('[data-testid="symptom-input"]')
    
    await symptomInput.setValue('å¤´ç—›')
    await wrapper.find('[data-testid="submit-button"]').trigger('click')
    
    expect(wrapper.emitted('diagnose')).toBeTruthy()
    expect(wrapper.emitted('diagnose')![0]).toEqual(['å¤´ç—›'])
  })
  
  it('åº”è¯¥åœ¨è¾“å…¥ä¸ºç©ºæ—¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯', async () => {
    const wrapper = mount(DiagnosisForm)
    
    await wrapper.find('[data-testid="submit-button"]').trigger('click')
    
    expect(wrapper.find('[data-testid="error-message"]').exists()).toBe(true)
    expect(wrapper.find('[data-testid="error-message"]').text()).toContain('è¯·è¾“å…¥ç—‡çŠ¶')
  })
})
```

### é›†æˆæµ‹è¯•æ¶æ„
```typescript
// tests/integration/diagnosis.integration.spec.ts
import { describe, it, expect, beforeEach } from 'vitest'
import { createPinia, setActivePinia } from 'pinia'
import { useDiagnosisStore } from '@/stores/diagnosis.store'
import { diagnosisService } from '@/services/diagnosis.service'

vi.mock('@/services/diagnosis.service', () => ({
  diagnosisService: {
    startDiagnosis: vi.fn(),
    generatePrescription: vi.fn()
  }
}))

describe('è¯Šæ–­æµç¨‹é›†æˆæµ‹è¯•', () => {
  let diagnosisStore: ReturnType<typeof useDiagnosisStore>
  
  beforeEach(() => {
    setActivePinia(createPinia())
    diagnosisStore = useDiagnosisStore()
  })
  
  it('åº”è¯¥å®Œæˆå®Œæ•´çš„è¯Šæ–­æµç¨‹', async () => {
    const mockPatientInfo = {
      name: 'å¼ ä¸‰',
      age: 35,
      gender: 'male' as const,
      medicalHistory: [],
      allergies: []
    }
    
    const mockSymptoms = {
      mainSymptoms: ['å¤´ç—›'],
      symptomDetails: 'å¤´ç—›å‰§çƒˆ',
      accompanyingSymptoms: [],
      triggeringFactors: 'å—å‡‰'
    }
    
    // æ¨¡æ‹ŸAIæœåŠ¡å“åº”
    vi.mocked(diagnosisService.startDiagnosis).mockResolvedValue({
      data: {
        id: 'diag_123',
        syndromeType: 'è‚é˜³ä¸Šäº¢è¯',
        confidence: 0.85
      }
    })
    
    // å¼€å§‹è¯Šæ–­
    await diagnosisStore.startDiagnosis(mockPatientInfo)
    
    expect(diagnosisStore.currentDiagnosis).toBeTruthy()
    expect(diagnosisStore.currentDiagnosis?.syndromeType).toBe('è‚é˜³ä¸Šäº¢è¯')
  })
})
```

## ğŸ“ˆ ç›‘æ§ä¸åˆ†ææ¶æ„

### æ€§èƒ½ç›‘æ§
```typescript
// utils/analytics.ts
export class AnalyticsManager {
  private static instance: AnalyticsManager
  
  static getInstance(): AnalyticsManager {
    if (!AnalyticsManager.instance) {
      AnalyticsManager.instance = new AnalyticsManager()
    }
    return AnalyticsManager.instance
  }
  
  trackPageView(page: string): void {
    if (import.meta.env.PROD) {
      this.sendAnalytics('page_view', { page })
    }
  }
  
  trackEvent(event: string, properties: Record<string, any>): void {
    if (import.meta.env.PROD) {
      this.sendAnalytics(event, properties)
    }
  }
  
  trackPerformance(): void {
    if (import.meta.env.PROD && window.performance) {
      const navigation = performance.getEntriesByType('navigation')[0] as PerformanceNavigationTiming
      
      this.sendAnalytics('performance', {
        loadTime: navigation.loadEventEnd - navigation.loadEventStart,
        domContentLoaded: navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart,
        firstPaint: this.getFirstPaint()
      })
    }
  }
  
  private sendAnalytics(event: string, properties: Record<string, any>): void {
    navigator.sendBeacon('/api/analytics', JSON.stringify({
      event,
      properties,
      timestamp: Date.now(),
      userAgent: navigator.userAgent,
      url: window.location.href
    }))
  }
  
  private getFirstPaint(): number {
    const paintEntries = performance.getEntriesByType('paint')
    const firstPaint = paintEntries.find(entry => entry.name === 'first-paint')
    return firstPaint ? firstPaint.startTime : 0
  }
}
```

### é”™è¯¯ç›‘æ§
```typescript
// utils/error-tracking.ts
export class ErrorTracker {
  static init(): void {
    // å…¨å±€é”™è¯¯å¤„ç†
    window.addEventListener('error', (event) => {
      this.trackError({
        type: 'javascript',
        message: event.message,
        filename: event.filename,
        lineno: event.lineno,
        colno: event.colno,
        stack: event.error?.stack
      })
    })
    
    // Promiseæ‹’ç»å¤„ç†
    window.addEventListener('unhandledrejection', (event) => {
      this.trackError({
        type: 'promise',
        message: event.reason?.message || 'Unhandled Promise Rejection',
        stack: event.reason?.stack
      })
    })
    
    // Vueé”™è¯¯å¤„ç†
    app.config.errorHandler = (error, instance, info) => {
      this.trackError({
        type: 'vue',
        message: error.message,
        stack: error.stack,
        component: instance?.$options.name,
        info
      })
    }
  }
  
  static trackError(error: ErrorInfo): void {
    if (import.meta.env.PROD) {
      navigator.sendBeacon('/api/errors', JSON.stringify({
        ...error,
        timestamp: Date.now(),
        url: window.location.href,
        userAgent: navigator.userAgent
      }))
    } else {
      console.error('Error tracked:', error)
    }
  }
}
```

---

**ä¼ æ‰¿åƒå¹´ä¸­åŒ»æ™ºæ…§ï¼Œèåˆç°ä»£ç§‘æŠ€åŠ›é‡** ğŸŒ¿âœ¨

æœ¬æ–‡æ¡£è¯¦ç»†é˜è¿°äº†æ™ºèƒ½ä¸­åŒ»è¯Šç–—ç³»ç»Ÿçš„æŠ€æœ¯æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬å‰ç«¯æ¶æ„ã€AIæœåŠ¡é›†æˆã€UI/UXè®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨æ¶æ„ã€æ•°æ®æ¶æ„ã€æµ‹è¯•æ¶æ„å’Œç›‘æ§åˆ†æç­‰å„ä¸ªæ–¹é¢ï¼Œä¸ºç³»ç»Ÿçš„å¼€å‘å’Œç»´æŠ¤æä¾›å…¨é¢çš„æŠ€æœ¯æŒ‡å¯¼ã€‚